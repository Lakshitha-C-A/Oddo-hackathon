name: Verify dev scripts

on:
  workflow_dispatch:

jobs:
  verify-dev:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    env:
      # Dummy key so server doesn't exit at start; never commit real keys to repo
      GOOGLE_API_KEY: ci_dummy_key
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Use Node.js 18
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Install root dependencies
        run: npm ci

      - name: Install server dependencies
        run: npm --prefix server ci

      - name: Start server
        run: |
          nohup npm --prefix server start > server.log 2>&1 &
          sleep 3

      - name: Start frontend
        run: |
          nohup npm run dev > vite.log 2>&1 &
          sleep 5

      - name: Check backend health
        run: |
          curl -v --fail http://localhost:4000/api/health

      - name: Upload logs
        if: failure()
        uses: actions/upload-artifact@v4
        with:
          name: logs
          path: |
            server.log
            vite.log
